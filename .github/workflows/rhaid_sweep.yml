name: Rhaid Sweep (Auto-fix PR)
on:
  schedule:
    - cron: "17 3 * * 1"
  workflow_dispatch:
jobs:
  sweep:
    runs-on: ubuntu-latest
    permissions:
      id-token: write
      contents: read
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-python@v5
        with:
          python-version: "3.11"
      - run: pipx install .
      - name: Run Rhaid (safe fixes)
        run: |
          rhaid --path . --mode fix --backup --rules "+format:*,+json:*,+yaml:*,+toml:*,+md:*,+mdx:*,+tf:*" --fix-only "+format:*,+json:*,+yaml:*,+toml:*,+md:*,+mdx:*,+tf:*"
      - name: Open PR with label
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          pip install pygit2 || true
          python scripts/open_pr.py
